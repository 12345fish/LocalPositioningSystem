/*====================================================================================================*/
/*====================================================================================================*/
#include "drivers\stm32f3_system.h"
#include "drivers\stm32f3_adc.h"
#include "modules\serial.h"

#include "uwbAnchor.h"
/*====================================================================================================*/
/*====================================================================================================*/
void UWBA_Init( void )
{
  UWBA_GPIO_Config();
  UWBA_ADC_Config();
  UWBA_UART_Config(NULL);
}
/*====================================================================================================*/
/*====================================================================================================*/
#define VADC            3.3f // 3.3V
#define ADC_R1          1000.0f // 1K
#define ADC_R2          2000.0f // 2K
#define VIN_MAX         (VADC * (ADC_R1 + ADC_R2) / ADC_R2)
#define ADC_RESOLUTION  (VIN_MAX / 4096)

static uint16_t vbat = 0;
static float32_t vbat_fp = 0.0f;

void UWBA_Loop( void )
{
  while(1) {
    LED_G_Toggle();
    vbat    = ADC_getData(1);
    vbat_fp = vbat * ADC_RESOLUTION;
    printf("Battery Vol ... %4.2f v (%5i)\r\n", vbat_fp, vbat);
    delay_ms(100);
  }
}
/*====================================================================================================*/
/*====================================================================================================*/
